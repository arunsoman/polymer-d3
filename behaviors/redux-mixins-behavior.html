<link rel="import" href="../../polymer-redux/polymer-redux.html">
<script src="../../redux/index.js"></script>
<script>

  const chartInitialState = {
      externals:[],
      source:[],
      charts:{}
}

  const chartAppReducer = (state, action) => {
      state = state || chartInitialState
      let chartObj = {
          externals:externalsReducer(state.externals, action),
          source:sourceReducer(state.source, action),
          charts: chartReducer(state.charts, action)
      }
      return chartObj
  }

  const chartReducer = (state, action) =>{
      switch (action.type) {
          case 'ADD_CHART':
              return Object.assign({},state,{[action.value.id]:action.value})
          case 'UPDATE_CHART':
              if(!state[action.value.id]){
                return Object.assign({},state,{[action.value.id]:action.value})
              }else{
                return state;
              }
          case 'ADD_UPDATE_CHART_INPUTS':
            return  Object.assign({},state,{[action.value.uuid]:Object.assign({},
              state[action.value.uuid],{
                inputs:Object.assign({},state[action.value.uuid].inputs,{
                  [action.value.objKey]:action.value.input
                })
              })})
          case 'REMOVE_CHART_INPUTS':
            return  Object.assign({},state,{[action.value.uuid]:Object.assign({},
              state[action.value.uuid],{
                inputs:Object.assign({},Object.keys(state[action.value.uuid].inputs).reduce((prev,next)=>{
                  if(next!=action.value.objKey){
                    prev[next]=state[action.value.uuid].inputs[next]
                  }
                  return prev
                },{}))
              })})
          case 'UPDATE_SETTINGS':
            return Object.assign({},state,{
              [action.value.id]:Object.assign({},state[action.value.id],{
                settings: action.value.settings
              }
              )})
          case 'UPDATE_PRIVATE_NODE':
              return Object.assign({},state,{
              [action.value.id]:Object.assign({},state[action.value.id],{
                chartkeys: Object.assign({},state[action.value.id].nodes,action.value.nodes)
              })
            })
          default:
              return state;
      }
  }

  const externalsReducer =(state, action)=>{
    switch(action.type){
      case"UPDATE_EXTERNALS":
        return state.concat(action.value)
      default:
          return state;
    }
  }
  const sourceReducer =(state, action)=>{
    switch(action.type){
      case"UPDATE_SOURCE":
        return state.concat(action.value)
      default:
          return state;
    }
  }


  // const store = Redux.createStore(chartAppReducer)

  const chartStore = Redux.createStore(  chartAppReducer,  chartInitialState,
    Redux.compose(window.devToolsExtension ? window.devToolsExtension() : v => v)
  );

  ReduxMixinBehavior = PolymerRedux(chartStore)

</script>
