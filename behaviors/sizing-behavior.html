<script>
  PolymerD3.sizingBehavior = {
    properties: {
        area: {
            type: Array
        }
    },
    observers: ['_areaChanged(settings.area.*)'],

    ready: function() {
        this.area = [
            {
                input: 'height',
                txt: 'Height of the chart',
                uitype: 'Number',
                selectedValue: 500
            }, {
                input: 'width',
                txt: 'Width of the chart',
                uitype: 'Number',
                selectedValue: 960
            }, {
                input: 'marginTop',
                txt: 'Top  margin',
                uitype: 'Number',
                selectedValue: 40
            }, {
                input: 'marginRight',
                txt: 'Right margin',
                uitype: 'Number',
                selectedValue: 10
            }, {
                input: 'marginBottom',
                txt: 'Bottom margin',
                uitype: 'Number',
                selectedValue: 20
            }, {
                input: 'marginLeft',
                txt: 'Left margin',
                uitype: 'Number',
                selectedValue: 50
            }
        ];
    },

    attached: function() {
        var unit = [1];
        var outerWidth = this._getWidth();
        var outerHeight = this._getHeight();
        var margin = this.getMargins();
        this.chartWidth  = outerWidth  - margin.left - margin.right;
        this.chartHeight = outerHeight - margin.top  - margin.bottom;
      
        var chartContainer = this.querySelector('.chartContainer');
        var d3CharContainer = d3.select(chartContainer);
        var svg = d3.select(d3CharContainer).data(unit);
        svg.enter().append("svg")
            .attr("width",  outerWidth)
            .attr("height", outerHeight)
            .attr("class", "chartSvgClass");
        
        svg.attr("width",  outerWidth)
            .attr("height", outerHeight);

        svg.exit().remove();

        this. parentG = svg.append("g")
            .attr("class" , "parentGClass")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    },

    _areaChanged:function(area){
        var me = this;
        var unit = [1];
        var outerWidth = this._getWidth();
        var outerHeight = this._getHeight();
        var margin = this.getMargins();
        this.chartWidth  = outerWidth  - margin.left - margin.right;
        this.chartHeight = outerHeight - margin.top  - margin.bottom;
      
        var svg = d3.select(this.querySelector('.chartSvgClass')).data[unit];
        svg.enter().append("svg")
            .attr("width",  outerWidth)
            .attr("height", outerHeight)
            .attr("preserveAspectRatio", "xMinYMin meet")
            .attr("viewBox", "0 0 " + chartWidth +" " + chartHeight +"")
            .attr("class", "chartSvgClass");
        
        svg.attr("width",  outerWidth)
            .attr("height", outerHeight);

        svg.exit().remove();

        this.parentG =  d3.select(this.querySelector('.chartSvgClass')).data(unit);
        this. parentG = svg.append("g")
            .attr("class" , "parentGClass")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
        
        this.parentG.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
        
        this.parentG.exit.remove();

    },

    _getHeight: function() {
        return parseInt(this.area[0]['selectedValue']);
    },
    _getWidth: function() {
        return parseInt(this.area[1]['selectedValue']);
    },
    getMargins: function() {
        return {
            top: parseInt(this.area[2]['selectedValue']),
            right: parseInt(this.area[3]['selectedValue']),
            bottom: parseInt(this.area[4]['selectedValue']),
            left: parseInt(this.area[5]['selectedValue'])
        }
    },
    registerHeightChange: function(scale, invert, scaleType){
        if(!this.heightScales)
            this.heightScales = [];
        this.heightScales.push([scale, invert, scaleType]);
        this._heightChanged();
    },
    registerWidthChange: function(scale, invert, scaleType){
        if(!this.widthScales)
            this.widthScales = [];
        this.widthScales.push([scale, invert, scaleType]);
        this._widthChanged();
    },
    _computeHeight: function(){
        var margin = this.getMargins();
        return this._getHeight() - margin.top - margin.bottom;
    },
    _computeWidth: function(){
        var margin = this.getMargins();
        return this._getWidth() - margin.left - margin.right;
    },
    _heightChanged: function(){
        if(this.heightScales){
            var height = this._computeHeight();
            this.heightScales.forEach(function(aScale){
                switch(aScale[2]){
                case 'time':
                case 'linear':
                    aScale[0].range(aScale[1]?[height,0]:[0,height]);
                    break;
                case 'category':
                    aScale[0].rangeRoundBands(aScale[1]?[height,0]:[0,height]);
                    break;
                }
            });
        }
    },
    _widthChanged: function(){
        if(this.widthScales){
            var width = this._computeWidth();
            this.widthScales.forEach(function(aScale){
                switch(aScale[2]){
                case 'time':
                case 'linear':
                    aScale[0].range(aScale[1]?[0, width]:[width, 0]);
                    break;
                case 'category':
                    aScale[0].rangeRoundBands(aScale[1]?[0, width]:[width, 0]);
                    break;
                }
            });
        }
    }
  }
</script>