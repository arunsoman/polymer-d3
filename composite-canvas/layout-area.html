<link href="../behaviors/redux-mixins-behavior.html" rel='import'>
<link href="chart-box.html" rel='import'>
<dom-module id="layout-area">
  <template>
    <style>
      :host #layoutArea{
        width:100%;
        min-height: 90vh;
        /*border:1px solid red;*/
      }
      #layoutArea:after{
        content: "";
        display:block;
        clear:both;
      }
      .row {
        margin-left: -5px;
        margin-right: -5px;
      }
      #layoutArea.drop{
        /*width:95%;*/
        transform: scale3d(1,1,1);
        background-color: #f6f6f6;
        box-shadow: 7px 1px 22px #474646;
        margin: 0;
      }
      #layoutArea.drop chart-box{
        opacity:.4;
      }
      div#layoutArea.compArea:after {
        content: "chart icons are drop here";
        display: block;
        position: absolute;
        width: 50%;
        font-size: 3.1em;
        top: 36%;
        left: 25%;
        color: #dadada
      }

    </style>
    <div id="layoutArea" class="row compArea" on-drop="drop" on-dragover="allowDrop" on-dragleave="dragLeave">
      <template is="dom-if" if="[[!newItemChk]]" restamp="true">
        <template is="dom-repeat" items="[[layoutData]]">
          <chart-box uuid="[[uuid]]" parent-id="[[parentId]]" chart-data="[[item]]"></chart-box>
        </template>
      </template>
    </div>
  </template>
  <script>
    class layoutArea extends ReduxMixinBehavior(Polymer.Element){
        static get is(){
          return "layout-area"
        }
        static get properties(){
          return{
            uuid:{
              type:String
            },
            layoutData:{
              type:Array,
              statePath(state){
                let chartPath = state.charts[this.uuid]
                let layoutData = chartPath && chartPath.layoutData
                return layoutData?layoutData:[]
              }
            },
            newItemChk:{
              type:Object,
              statePath(state){
                let chartPath = state.charts
                let newItemChk = chartPath && chartPath.newItemChk
                return newItemChk
              }
            }
          }
        }
        static get actions() {
          return{
            newItemChk(itemChk){
              return {
                type: 'NEW_ITEM_CHK',
                value: itemChk
              };
            }
          }
        }
        dragLeave(e){
          e.target.classList.remove('drop');
        }
        allowDrop(e){
          e.preventDefault();
          e.target.classList.add('drop');
        }
        drop(e){
          e.preventDefault();
          let chartElem = e.dataTransfer.getData('chartElem');
          if(chartElem){
            e.target.classList.remove('drop');
            e.target.classList.remove('compArea');
            this.createChartBox(chartElem)
            e.dataTransfer.clearData('chartElem');
          }
        }
        createChartBox(chartElem){
          let chartBox = document.createElement("chart-box")
          let chartItem={}
          chartItem.chartCls="col-md-6"
          chartItem.elem=chartElem
          chartItem.chartWidth = ((this.$.layoutArea.offsetWidth* 50)/100)-22
          let chartHeight = this.$.layoutArea.offsetHeight
          chartHeight = this.$.layoutArea.offsetHeight<=554?chartHeight:554
          chartHeight = chartHeight/2
          chartHeight = chartHeight+(chartHeight/2)
          chartItem.chartHeight = chartHeight
          chartItem.chartCreate = true
          chartBox.set("uuid",this.uuid)
          chartBox.set("parentId",this.parentId)
          chartBox.set("chartData",chartItem)
          this.$.layoutArea.appendChild(chartBox)

          this.layoutData.length==1&&this.dispatch("newItemChk",{uuid:this.uuid,newItemChk:true})
        }
    }
    customElements.define(layoutArea.is,layoutArea)
  </script>
</dom-module>
