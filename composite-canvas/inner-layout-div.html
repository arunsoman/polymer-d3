<link rel="import" href="../../vaadin-split-layout/vaadin-split-layout.html">
<link rel="import" href="../../iron-dropdown/iron-dropdown.html">
<link rel="import" href="../../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../iron-icons/iron-icons.html">
<link rel="import" href="../../paper-item/paper-item.html">
<link rel="import" href="../display-component/chart-holder.html">

<dom-module id="inner-layout-div">
  <template>
    <style>
      header{
        border-bottom:1px #d3d3d3 solid;
      }
      #splitBox{
        position: relative;
        min-height: 200px;
      }
      #dropDown{
        margin-top:20px;
        border: 1px lightgrey solid;
        background-color: white;
      }
      #dropDown paper-item{
        width: 29px;
        min-height: 16px;
        cursor: pointer;
        font: 10px sans-serif;
        border-bottom: 1px lightgrey solid;
      }
      #dropDown paper-item:last-child{
        border-bottom:none;
      }
      .paperIconBtn, .addRemoveBtn{
        padding:5px;
        width: 25px;
        height: 25px;
      }
      :host #splitter{
        display:none;
      }
      paper-dialog {
        top: 5%;
        left: 2%;
        width: 90%;
        margin: 0;
        position: relative;
      }
      paper-icon-button.dialog-close {
        width: 25px;
        height: 25px;
        position: absolute;
        right: -12px;
        top: -12px;
        background: white;
        color:grey;
        border: 1px solid #ededed;
        border-radius: 50%;
        padding: 4px;
        margin: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 999;
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
    }
    </style>
    <div id="splitBox">
      <header>
      <paper-icon-button icon="more-horiz" slot="dropdown-trigger" on-click="showDropDown" class="paperIconBtn">select</paper-icon-button>
      <iron-dropdown horizontal-align="left" vertical-align="top" id="dropDown">
        <div slot="dropdown-content">
          <paper-item on-click="createSplitLayout" id="vert">Column</paper-item>
          <paper-item on-click="createSplitLayout" id="horz">Row </paper-item>
          <template is="dom-if" if="{{freeze}}">
            <paper-item on-click="deleteSplitLayout" id="delete">Delete</paper-item>
          </template>
        </div>
      </iron-dropdown>
      <template is="dom-if" if="{{!selectedItem.showCompChart}}" restamp="true">
        <paper-icon-button icon="add" on-click="showChart" class="addRemoveBtn">Add/Remove Chart</paper-icon-button>
      </template>
      <template is="dom-if" if="{{selectedItem.showCompChart}}" restamp="true">
        <paper-icon-button icon="remove" on-click="removeChart" class="addRemoveBtn">Add/Remove Chart</paper-icon-button>
      </template>
      <paper-dialog id="chartSelectedModal" modal noCancelOnOutsideClick>
        <paper-icon-button icon="close" on-click="dialogClose" class="dialog-close">close</paper-icon-button>
        <chart-holder settings-visible composite-value selected-item="{{selectedItem}}"></chart-holder>
      </paper-dialog>
    </header>
    </div>
  </template>
  <script>
    class innerLayoutDiv extends Polymer.Element{
      static get is(){
        return "inner-layout-div"
      }
      static get properties(){
        return{
          align:{
            type:Boolean,
            notify:true
          },
          valign:{
            type:Boolean,
            value:false,
            notify:true
          },
          freeze:{
            type:String,
            value:"false",
            notify:true
          },
          addRemove:{
            type:Boolean,
            value:true,
            notify:true
          },
          selectedItem:{
            type:Object,
            value:() => {return {};},
            notify:true
          }
        }
      }
      // static get observers(){
      //   return["checkDialog(selectedItem)"]
      // }
      showDropDown(){
        this.$.dropDown.open();
      }
      showChart() {
        this.$.chartSelectedModal.open();
        this.set("selectedItem",{showCompChart:true})
        this.$.chartSelectedModal.backdropElement.toggleAttribute("hidden",true)
        // debugger
      }
      dialogClose(){
        this.$.chartSelectedModal.close();
        this.set("selectedItem",{showCompChart:false})
      }
      removeChart(){
        let chartBox = this.$.splitBox.querySelector("#chartBox")
        chartBox.remove()
        this.set("selectedItem",{showCompChart:false})
      }
      // checkDialog(){
      //
      // }
      constructor(){
        super()
      }
      createSplitLayout(e){
        let eleDiv = document.createElement('inner-layout-div');
        let eleDiv2 = document.createElement('inner-layout-div')
        let eleSplit = document.createElement('inner-layout-split');
        let vertical = e.currentTarget.id=='horz'
        let childElemCount = this.parentNode.children.length
        let chartBox = this.$.splitBox.querySelector("#chartBox")
        if(childElemCount==1 || childElemCount==2 && chartBox){
          this.set('align',vertical)
          this.parentNode.appendChild(eleDiv)
        }else if(childElemCount==2){
          if(this.$.splitBox.lastChild.tagName!="INNER-LAYOUT-SPLIT"){
            eleSplit.set('freeze',"true")
            eleSplit.set('align',vertical)
            this.$.splitBox.appendChild(eleSplit)
            this.$.splitBox.lastChild.$.grid.appendChild(eleDiv)
            this.$.splitBox.lastChild.$.grid.appendChild(eleDiv2)
          }
        }
        this.$.dropDown.close();
      }
      deleteSplitLayout(e){
        //   this.set('addRemove',true);
        if(this.parentNode.children.length == 1){
          this.parentNode.remove()
        }else{
          this.remove()
        }
        this.$.dropDown.close();
      }
    }
    customElements.define(innerLayoutDiv.is, innerLayoutDiv)
  </script>
</dom-module>
