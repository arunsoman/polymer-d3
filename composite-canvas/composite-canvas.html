<link rel="import" href="../display-component/base-chart.html">
<link rel="import" href="recursive.html">
<link rel="import" href="chart-selected-modal.html">
<dom-module id="composite-canvas">
  <template>
    <style>
      :host {
        display: block;
      }
      .flex{
        display: flex;
      }
      chart-holder{
        flex:1;
      }
      #splitLayoutArea{
        min-height: 50vh;
      }
    </style>
    <template is="dom-if" if="[[!compSettingsDisabled]]" restamp="true">
      <chart-input-group  uuid="[[uuid]]">
        <chart-input slot="chart-input" axis="x" label="x-axis"></chart-input>
        <chart-input slot="chart-input" axis="y" label="value" accept="number"></chart-input>
        <chart-input slot="chart-input" axis="z" label="z-axis"></chart-input>
      </chart-input-group>
      <chart-settings uuid="[[uuid]]"></chart-settings>
    </template>
    <chart-selected-modal id="chartsModal" uuid="[[uuid]]"></chart-selected-modal>
    <div id="splitLayoutArea">
      <recursive-node uuid="[[uuid]]"></recursive-node>
    </div>
  </template>
  <script>
    /**
    * @polymer
    * @extends HTMLElement
    */
    class compositeCanvas extends baseChart{
      static get is(){
        return "composite-canvas"
      }
      static get properties(){
        return{
          compSettingsDisabled:{
            type:Boolean,
            value:false
          },
          compositeChartData:{
            type:Object,
            statePath(state){
              let chartPath = state.charts[this.uuid]
              let compositeChartData = chartPath && chartPath.compositeChartData
              return compositeChartData
            }
          },
          compositeChartDefaultData:{
            type:Object,
            value:()=>{
              return {
              "id": "chartData",
              "vertical": false,
              "freeze": false,
              "style": "",
              "chart": "",
              "chartId":"",
              "paragraphId":"",
              "settingsDisabled":false,
              "children": [
                {
                  "id": "chartData_0",
                  "vertical": false,
                  "freeze": true,
                  "style": "",
                  "chart": "",
                  "chartId":"",
                  "settingsDisabled":false,
                  "children": []
                }
              ]
            }
          }
        },
        layoutAreaChk:{
          type:Boolean,
          observer:"areaChk",
          statePath(state){
            let chartPath = state.charts[this.uuid]
            let layoutAreaChk = chartPath && chartPath.layoutAreaChk
            return layoutAreaChk
          }
        },
        chartAvailableModalChk:{
          type:Boolean,
          observer:"chartAvailableModal",
          statePath(state){
            let chartPath = state.charts[this.uuid]
            let chartAvailableModalChk = chartPath && chartPath.chartAvailableModalChk
            return chartAvailableModalChk
          }
        },
        chartSettings:{
          type:Object,
          observer:'areaChk',
          statePath(state){
            let chartPath = state.charts[this.uuid]
            let chartSettings = chartPath && chartPath.settings
            return chartSettings
          }
        }
      }
    }
    static get actions() {
      return {
        addUpdateChartData(addUpdateChartData) {
          return {
            type: 'ADD_UPDATE_COMPOSITE_CHART_DATA',
            value: addUpdateChartData
          }
        }
      }
    }
    connectedCallback(){
      super.connectedCallback()
      !this.compositeChartData && this.dispatch("addUpdateChartData", {uuid:this.uuid,chartData:this.compositeChartDefaultData})
    }
    areaChk(){
      this.$.splitLayoutArea.innerHTML=""
      let recursiveNode = document.createElement("recursive-node")
      recursiveNode.set("uuid",this.uuid)
      this.$.splitLayoutArea.appendChild(recursiveNode)
    }
    chartAvailableModal(){
      this.$.chartsModal.root.querySelector("#chartSelectedModal").open()
    }
      redraw() {
        this.draw(this._compute());
      }
      _compute() {
        //assign axisIndex value
        let axisIndex = 3
        //"chartProp" define for chart axis and properties
        let arg = {axisIndex}
        let chartProp = this.getChartProperties(arg)
        if(!chartProp)return false

      }
    }
    customElements.define(compositeCanvas.is,compositeCanvas)
  </script>
</dom-module>
