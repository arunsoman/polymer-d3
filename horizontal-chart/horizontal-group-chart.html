<!-- This chart is specifically built to be transformed into a 100% chart -->
<link rel="import" href="../display-component/base-chart.html">
<dom-module id="horizontal-group-chart">
  <template>
    <style>
      #chartContainer{
        margin:0 auto;
        font: 10px sans-serif;
        position: relative;
      }
      .toolTip {
          font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
          position: absolute;
          display: none;
          width: auto;
          height: auto;
          background: none repeat scroll 0 0 white;
          border: 0 none;
          border-radius: 8px 8px 8px 8px;
          box-shadow: -3px 3px 15px #888888;
          color: black;
          font: 12px sans-serif;
          padding: 5px;
          text-align: center;
      }

      text {
          font: 9px sans-serif;
          color: white;
      }
      text.value {
          font-size: 90%;
          fill: white;
      }

      .axisHorizontal path{
          fill: none;
      }

      .axisHorizontal .tick line {
          stroke-width: 1;
          stroke: rgba(0, 0, 0, 0.2);
      }

      .bar {
          fill: steelblue;
          fill-opacity: .9;
      }

    </style>
    <chart-input-group  uuid="[[uuid]]">
      <chart-input slot="chart-input" axis="x" label="Key"></chart-input>
      <chart-input slot="chart-input" axis="y" label="Value" accept="number"></chart-input>
      <chart-input slot="chart-input" axis="z" label="Key"></chart-input>
    </chart-input-group>
    <chart-settings uuid="[[uuid]]"></chart-settings>
    <div id="chartContainer"></div>
  </template>
  <script>
    class horizontalGroupChart extends baseChart{
      static get is(){
        return "horizontal-group-chart"
      }
      static get properties(){
        return{}
      }
      constructor(){
        super()
      }
      redraw() {
        this.draw(this._paint(this._compute()));
      }
      _compute() {
        //axis are mentioned in the chart-input module
        let itemX = this.x ? this.inputs[this.x].selectedValue : []
        let itemY = this.y ? this.inputs[this.y].selectedValue : []
        let itemZ = this.z ? this.inputs[this.z].selectedValue : []

        //"itemChk" for avoid error from chart
        let itemChk = itemX.length <= 0 || itemY.length <= 0 || itemZ.length<=0

        if (itemChk) {
            return false;
        }
        //axis inputs selectedValue assigin
        itemX = itemX[0]
        itemY = itemY[0]
        itemZ = itemZ[0]

        let parseDate = d3.time.format('%Y-%m-%d').parse;
        let width = +this.settings.width.value,
            height = +this.settings.height.value,
            margin = {top: 5, right: 40, bottom: 20, left: 120},
            label= this.settings.legend.values
            //margin = {top: +this.settings.margin.value.top, right: +this.settings.margin.value.right, bottom: +this.settings.margin.value.bottom, left: +this.settings.margin.value.left}
        // width = width - margin.left - margin.right
        // height = height - margin.top - margin.bottom

        let color = d3.scale.category20();

        //get chart data once pass "x and y" into the "getChartData" method
        let source = this.getChartData(itemX, itemY,itemZ)


        return {
          width,
          height,
          margin,
          itemChk,
          chartData,
          color,
          label
        }
      }
      _paint(obj) {
        d3.select(this.$.chartContainer).html("")
        if (!obj || obj.itemChk) {
          return false
        }
        //Draw Horizontal group chart and append the svg canvas to the page

      }
      // populate chart data
      getChartData(itemX, itemY,itemZ){
        let sourceData = this.source.reduce((old,newVal)=>{
          old[newVal[itemX]]=(old[newVal[itemX]]||0)+(+newVal[itemY])
          return old
        },{})
        let data  = Object.keys(sourceData).map(item=>{return {xKey:item,yKey:sourceData[item]}})
        return{data}
      }
    }
    customElements.define(horizontalGroupChart.is, horizontalGroupChart)
  </script>
</dom-module>
