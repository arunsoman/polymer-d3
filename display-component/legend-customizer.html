<dom-module id="legend-customizer">
  <template>
    <style>
    #chartArea {
      height: 263px;
      /*height: 150px;*/
      margin: 2em 0;
      position: relative;
      background: #f2f0ee;
      box-shadow: 0px 0px 22px rgba(0, 0, 0, 0.2) inset;
      /*resize: both;*/
      /*overflow: auto;*/
      width: 100%;
    }

    #legends {
      position: absolute;
      background: #ffec93;
      padding: 1px 6px;
      border-radius: 11px;
      color: #c39c19;
      border: solid 1px;
      z-index: 99;
    }

    #legends iron-icon {
      position: absolute;
      width: 1.2em;
      margin-left: 0.5em;
      margin-top: -0.2em;
      cursor: pointer;
    }

    .flex {
      display: flex;
      flex-wrap: wrap;
      margin: 0 2em;
    }

    .flex paper-input {
      flex-grow: 3;
      display: inline-block;
      width: 20%;
    }
    .resizable{
    border: solid 1px #bbbab9;
    overflow: auto;
    background: rgba(255, 236, 147, 0.32);
    position: absolute;
    }
    .resizable.right{
      width: 10px;
      resize: horizontal;
      right: 0;
      top:0;
      bottom: 0;
      direction: rtl;
      border-top: 0;
      border-bottom: 0; 
      max-width: 80%;
      min-width: 10px!important;
    }
    .resizable.left{
     width: 10px;
     resize: horizontal;
     left: 0;
     top:0;
     bottom: 0;
     border-top: 0;
     border-bottom: 0;
     max-width: 80%; 
     min-width: 10px!important;
    }
    .resizable.top{
     resize: vertical;
     left: 0;
     top:0;
     right: 0;
     height: 10px;
     z-index: 9;
     position: relative;
    }
    .resizable.bottom{
      resize: vertical;
      left: 0;
      top: 0;
      right: 0;
      height: 10px;
      position: relative;
    }
    .resizable-wrapper{
      position: relative;
    }
    .resizable-wrapper .inner{
      min-height: 150px;
      position: relative;
    }
    .resizable-wrapper.middle{
      min-height: 150px;
    }

    </style>
    <div id="chartArea" on-drop="drop" on-dragover="allowDrop">
    <resizer-element element-align="left" margin-value="{{margin.left}}"></resizer-element>
    <resizer-element element-align="top" margin-value="{{margin.top}}"></resizer-element>
    <resizer-element element-align="right" margin-value="{{margin.right}}"></resizer-element>
    <resizer-element element-align="bottom" margin-value="{{margin.bottom}}"></resizer-element>
    <!-- <div class="resizable-wrapper top">
      <div class="resizable top"></div>
    </div>
    <div class="resizable-wrapper middle">
      <div class="inner">
        <div class="resizable left" ></div>
        <div class="resizable right"></div>
      </div>
      <div class="resizable bottom"></div>
    </div> -->
      <div id="legends" draggable="true" style$="left:[[legendData.position.x]]%;top:[[legendData.position.y]]%;">Legend
        <iron-icon icon="icons:invert-colors" label="legends" on-click="showColorPicker"></iron-icon>
      </div>
    </div>
    <paper-dialog id="dialog" modal>
      <h2>Label color picker</h2>
      <paper-dialog-scrollable>
        <div class="flex">
          <template is="dom-repeat" items="[[keys]]">
            <paper-input label="[[item.key]]">
              <paper-swatch-picker color="{{item.color}}" slot="prefix"></paper-swatch-picker>
            </paper-input>
          </template>
        </div>
      </paper-dialog-scrollable>
      <div class="buttons">
        <paper-button dialog-dismiss on-click="save">Apply</paper-button>
        <paper-button dialog-dismiss>Cancel</paper-button>
      </div>
    </paper-dialog>
  </template>
  <script>
  /**
  * @polymer
  * @extends HTMLElement
  */
  class legendCustomizer extends Polymer.Element {
    static get is() {
      return 'legend-customizer'
    }

    static get properties() {
      return {
        legendData: {
          type: Object
        },
        legendSettings: {
          notify: true
        },
        legendKeys:{
          type:Object,
          observer:'tansformKeys'
        },
        margin:{
          type:Object,
          value:{
            left:0,
            right:0,
            top:0,
            bottom:0
          },
          notify:true
        }
      }
    }

    tansformKeys(items){
      this.set('keys',Object.keys(items).map((item,i)=>items[i]));
    }
    showColorPicker() {
      this.$.dialog.open();
    }
    allowDrop(ev) {
      ev.preventDefault();
    }

    drop(e) {
      let getchartWidth = this.$.chartArea.offsetWidth;
      let getchartHeight = this.$.chartArea.offsetHeight;
      let xpos = ((e.offsetX - 30) / getchartWidth) * 100;
      let ypos = ((e.offsetY - 12) / getchartHeight) * 100;
      let position = {
        x: xpos,
        y: ypos
      }
      this.set('legendData.position', position);
      this.set('legendSettings', Object.assign({}, this.legendData));
    }

    constructor() {
      super();
    }
    ready(){
      super.ready();
    }
    connectedCallback(){
      // debugger;
    }
    getOnTrack(){
      setTimeout(()=>{
       debugger; 
      })
      console.log('change');
      debugger;
    }
    save(){
      this.set('legendData.nodes',this.keys)
    }

  }
  customElements.define(legendCustomizer.is, legendCustomizer)
  </script>
</dom-module>
