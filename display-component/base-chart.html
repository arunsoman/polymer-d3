<link href="../behaviors/redux-mixins-behavior.html" rel='import'>

<link rel="import" href="chart-setting.html"/>
<dom-module id="base-chart">
<template>
  <h3>[[settings.title]]</h3>
</template>
<script>

  class baseChart extends Polymer.mixinBehaviors(
    [PolymerD3.toolTipBehavior],ReduxMixinBehavior(Polymer.Element)
    ){
    static get is(){ return 'base-chart'}

    static get properties(){
      return{
        redrawChk:{
          type:Boolean
        },
        uuid:{
          type:String
        },
        axisKeys:{
          type:String,
          statePath(state){
            let chartPath = state.charts[this.uuid]
            let keyChk = chartPath && Object.keys(chartPath.inputs).length
            let keys = keyChk && Object.keys(chartPath.inputs)
            return keys
          }
        },
        inputs:{
          type:Array,
          statePath(state){
            var chartPath = state.charts[this.uuid]
            let keyChk = chartPath && Object.keys(chartPath.inputs).length
            return keyChk ? chartPath.inputs:{}
          },
          readOnly:true
        },
        // groupBy:{
        //   type:String
        // },
        // x:{
        //   type:String
        // },
        // y:{
        //   type:String
        // },
        // z:{
        //   type:String
        // },
        settings:{
          type:Object,
          value:()=>{
            return {
              title:"",
              marginTop:"",
              marginBottom:"",
              marginLeft:"",
              marginRight:"",
              legendPosition:"",
              legendColor:"",
              width:960,
              height:500
            }
          }
        },
        externals:{
          type:Array,
          statePath(state){
            return state.externals
          }
        },
        source:{
          type:Array,
          statePath(state){
            return state.source
          }
        }
      }
    }
    static get observers(){
      return["_chartDraw(inputs)"]
    }

    constructor(){
      super();//baseChart
      this.initializeChart()
    }
    static get actions() {
      return {
        updateChart(chartProperies) {
          return {
            type: 'UPDATE_CHART',
            value: chartProperies
          };
        }
      };
    }
    connectedCallback(){
      super.connectedCallback()
    }
    _chartDraw(inputs){
      if(inputs && Object.keys(inputs).length!=0){
        //chart axis dre set here, the axis key's defined in "chart-input" module
        this.axisKeys.forEach(axis=>{this.set(axis,axis)})
        this.redraw()
      }
    }
    draw(paint){
      //this.debounce(arg,interval)
      this.debouncer(paint,250)
    }
    debouncer(arg,interval){
        return Polymer.Debouncer.debounce(this.debouncer,
          Polymer.Async.timeOut.after(interval), () => {arg});
    }
    initializeChart(){
        this.set("uuid",PolymerD3.utilities.getUUID())
    }
  }
  customElements.define(baseChart.is,baseChart)

</script>
</dom-module>
